{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "accountResourceId": { "type": "string" },
        "identityId": { "type": "string" },
        "forceUpdateTag": { 
            "type": "string",
            "defaultValue": "[utcNow()]" 
        }
    },
    "resources": [
        {
            "type": "Microsoft.Resources/deploymentScripts",
            "apiVersion": "2020-10-01",
            "name": "CreateDependentResouces",
            "location": "[resourceGroup().location]",
            "kind": "AzurePowerShell",
            "identity": {
                "type": "userAssigned",
                "userAssignedIdentities": {
                    "[parameters('identityId')]": {}
                }
            },
            "properties": {
                "forceUpdateTag": "[parameters('forceUpdateTag')]",
                "azPowerShellVersion": "8.3",
                "primaryScriptUri": "https://gist.githubusercontent.com/tshaiman/b6e3818b1ae70642d713db88bdcb828d/raw/2d678b7208a9067d06e43b9dd34bc237b16bde79/get_hobo_secret.ps1",
                "timeout": "PT30M",
                "cleanupPreference": "OnSuccess",
                "retentionInterval": "PT1H",
                "arguments": "[concat('-accountResourceId', ' ', parameters('accountResourceId'))]"
            }
        }
    ],
    "outputs": {
      "result": {
        "value": "[reference('CreateDependentResouces').outputs.result]",
        "type": "string"
      }
    }
}